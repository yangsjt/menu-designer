# /更新菜单

读取 CSV 数据源，对比 HTML 差异，确认后同步更新墙面菜单和 A4 立牌菜单。

## 数据源文件

| 数据源 | 目标文件 |
|--------|----------|
| `docs/动径咖啡店铺菜单 - 当前菜单.csv` | `wall-menu.html` + `a4-menu.html` |

CSV 是菜单的**唯一数据源**，包含 33 行有效数据（序号 1-28 + 31-33），覆盖 6 个类别。

## 严格格式验证

### CSV 必须包含以下列（B-I 列，顺序固定）：

| 列 | 列名 | 必填 | 说明 |
|----|------|------|------|
| B | 序号 | 是 | 1-28, 31-33 的数字编号 |
| C | 类别 | 是 | 6 个类别之一（见下方类别清单） |
| D | 品名 | 是 | 中文产品名称 |
| E | 英文名/包含内容 | 是 | 英文名或套餐内容描述 |
| F | 描述/规格 | 否 | 产品描述或规格说明 |
| G | 规格 | 否 | Ice/Hot 标注（仅供参考，HTML 不显示） |
| H | 价格 (¥) | 是 | 纯数字、`+N`、`-N`、`N元/小时` |
| I | 店长推荐 | 否 | `是` 或空白 |

### 6 个有效类别值：

`季节限定`、`动径特调`、`能量组合`、`经典日常`、`非咖啡类`、`自行车租赁`

## 执行流程

### 第 1 步：读取文件

检查以下 3 个文件是否存在：
- `docs/动径咖啡店铺菜单 - 当前菜单.csv`
- `wall-menu.html`
- `a4-menu.html`

任一文件缺失 → 报错并终止。

### 第 2 步：验证 CSV 列名

读取 CSV 第一行（表头），确认 B-I 列的列名完全匹配上方定义。

列名不符 → 拒绝执行，列出缺失/不匹配的列，要求用户修正。

### 第 3 步：解析数据

按 C 列（类别）分组，提取所有有效数据行：

| 类别 | 预期序号 | 预期行数 |
|------|----------|----------|
| 季节限定 | 1-3 | 3 |
| 动径特调 | 4-10 | 7 |
| 能量组合 | 11-13 | 3 |
| 经典日常 | 14-22 | 9（含升级项） |
| 非咖啡类 | 23-28 | 6 |
| 自行车租赁 | 31-33 | 3 |

序号不连续或行数不符 → 报告异常但不终止（可能是正常的菜单调整）。

### 第 4 步：对比差异

逐条对比 CSV 数据与两个 HTML 文件中的当前内容：
- 品名（D 列 vs `.cn-name` / `.pl-name` / `.combo-title`）
- 英文名（E 列 vs `.en-name` / `.pl-en` / `.combo-tag`）
- 描述（F 列 vs `.desc` / `.combo-desc`）
- 价格（H 列 vs `.price` / `.pl-price` / `.combo-badge`）
- 店长推荐（I 列 vs 品名后是否有 👍 span）
- 条件类（`.premium` / `.accent` / `.highlight` / `.upgrade`）是否需要变更

**价格对比原则：CSV 原值（去除首尾空格后）直接与 HTML 显示文本对比，禁止任何隐式格式转换（如 `+15` ≠ `加15`）。**

### 第 5 步：展示变更报告（用户确认门控）

以下格式展示差异，**必须等待用户确认后才执行修改**：

```
## 变更报告

### 季节限定（序号 1-3）
- 🔄 序号 1「鸿运当头」→ 价格 35→38
- ✅ 序号 2「好事花生」无变更
- ➕ 序号 3 新增品项「xxx」

### 动径特调（序号 4-10）
- 🔄 序号 5「xxx」→ 英文名变更、需加 .accent 类
...

### 经典日常（序号 14-22）
...

### 非咖啡类（序号 23-28）
...

### 能量组合（序号 11-13）
...

### 自行车租赁（序号 31-33）
...

⚠️ 需手动处理：
- 季节限定图片变更：序号 X 品名已更换，需提供新图片到 imgs/ 目录

---
共 N 项变更，确认执行？
```

如果**无任何变更** → 提示"CSV 与 HTML 完全一致，无需更新"并结束。

用户拒绝 → 终止，不修改任何文件。

### 第 6 步：执行更新

用户确认后，**同时修改** `wall-menu.html` 和 `a4-menu.html`：

1. 按类别逐一更新对应 HTML 元素（参照下方字段映射表）
2. 同步更新条件类（`.premium` / `.accent` / `.highlight` / `.upgrade`）
3. 同步更新店长推荐 👍 标记
4. 确保价格格式正确

### 第 7 步：验证结果

更新完成后：
1. 报告变更摘要（修改了哪些品项、哪些字段）
2. 提醒手动检查事项：
   - 季节限定图片是否需要更新（品名变更时）
   - 浏览器预览验证显示效果（`python3 -m http.server 8000`）
   - 如需导出 PDF：`npm run pdf`

---

## 错误处理

| 错误类型 | 处理方式 |
|----------|----------|
| CSV 文件不存在 | 报错终止，提示文件路径 |
| HTML 文件不存在 | 报错终止，提示缺失的文件名 |
| CSV 列名不符 | 拒绝执行，列出缺失/不匹配的列名 |
| 序号缺失或不连续 | 警告但继续（可能是正常调整） |
| 类别值不在有效列表中 | 警告并跳过该行 |
| 季节限定品名变更但图片缺失 | 警告提醒，不终止 |
| HTML 中找不到对应元素 | 报错，列出未匹配的序号 |

---

## CSV 列定义

### B 列：序号
- 数字类型，1-28 + 31-33
- 29-30 为保留序号（当前未使用）

### C 列：类别
- 6 个固定值：`季节限定`、`动径特调`、`能量组合`、`经典日常`、`非咖啡类`、`自行车租赁`

### D 列：品名
- 中文产品名称
- 特例：D 列为 `升级项` 时，显示名取 E 列

### E 列：英文名/包含内容
- 季节限定/动径特调：英文名
- 能量组合：英文标签名（全大写显示）
- 经典日常/非咖啡类：英文名
- 升级项：显示为品名（如 `燕麦奶 / 冰博克升级`）

### F 列：描述/规格
- 产品描述文案（逗号分隔的风味关键词）
- 能量组合：套餐包含内容描述

### G 列：规格
- `Ice`、`Hot`、`Ice / Hot`
- 仅供参考，HTML 不显示此列

### H 列：价格
- 纯数字（如 `25`、`38`、`42`）
- `+N` 格式（能量组合加价，如 `+15`）
- `-N` 格式（能量组合减价，如 `-5`）
- `N元/小时` 格式（自行车租赁）

### I 列：店长推荐
- `是` → 品名后加 `<span style="font-size:0.65em">👍</span>`
- 空白 → 确保品名后无 👍 span

---

## CSV → HTML 字段映射

### 类别 1：季节限定（序号 1-3）

**HTML 位置：**
- 墙面菜单：`.col-seasonal` > `.seasonal-cards` > `.seasonal-card`
- A4 菜单：`.col-seasonal` > `.seasonal-cards` > `.seasonal-card`

| CSV 列 | HTML 元素 | 说明 |
|---------|-----------|------|
| D 品名 | `.seasonal-card .cn-name` | 中文品名 |
| E 英文名 | `.seasonal-card .en-name` | **全大写显示** |
| F 描述 | `.seasonal-card .desc` | 风味描述 |
| H 价格 | `.seasonal-card .price` | 纯数字 |
| I 推荐 | `.cn-name` 后追加 👍 span | `是` 时添加 |

**图片：**
- `<img>` 标签在 `.seasonal-card` 内
- `alt` 属性 = 品名
- 图片路径：`imgs/{品名}.jpg` 或 `.png`
- 规格：548 x 306 px / 16:9

### 类别 2：动径特调（序号 4-10）

**HTML 位置：**
- `.col-sig` > `.sig-grid` > `.sig-item`
- 7 个品项占据 2x4 网格前 7 格，第 8 格为 Logo 水印（不可修改）

| CSV 列 | HTML 元素 | 说明 |
|---------|-----------|------|
| D 品名 | `.sig-item .cn-name` | 中文品名 |
| E 英文名 | `.sig-item .en-name` | **原始大小写** |
| F 描述 | `.sig-item .desc` | 风味描述 |
| H 价格 | `.sig-item .price` | 纯数字 |
| I 推荐 | `.cn-name` 后追加 👍 span | `是` 时添加 |

### 类别 3：能量组合（序号 11-13）

**HTML 位置：**
- `.col-sig` > `.combo-mini-list` > `.combo-mini`

| CSV 列 | HTML 元素 | 说明 |
|---------|-----------|------|
| D 品名 | `.combo-mini .combo-title` | 套餐名称 |
| E 英文名 | `.combo-mini .combo-tag` | **全大写显示** |
| F 描述 | `.combo-mini .combo-desc` | 套餐内容描述 |
| H 价格 | `.combo-mini .combo-badge` | 见价格规则 |
| I 推荐 | `.combo-title` 后追加 👍 span | `是` 时添加 |

### 类别 4：经典日常（序号 14-22）

**HTML 位置：**
- 墙面菜单：`.col-classic` > `.classic-sub-drinks` > 第一个 `.price-list.compact-list`
- A4 菜单：`.col-classic` > `.classic-inner` > 第一个 `.classic-sub-drinks` > `.price-list.compact-list`

| CSV 列 | HTML 元素 | 说明 |
|---------|-----------|------|
| D 品名 | `.pl-row .pl-name` | 中文品名（升级项用 E 列） |
| E 英文名 | `.pl-row .pl-en` | 英文名 |
| H 价格 | `.pl-row .pl-price` | 纯数字或 `+N` |

**升级项特殊处理：**
- D 列 = `升级项` → `.pl-row` 加 `.upgrade` 类
- 升级项的显示名取 E 列（如 `燕麦奶 / 冰博克升级`）
- 价格显示为 `+N`（加号前缀）
- 普通行与升级项之间有 `<hr class="pl-divider">`

### 类别 5：非咖啡类（序号 23-28）

**HTML 位置：**
- 墙面菜单：`.col-classic` > `.classic-sub-drinks` > 第二个 `.price-list.compact-list`
- A4 菜单：`.col-classic` > `.classic-inner` > 第二个 `.classic-sub-drinks` > `.price-list.compact-list`

映射方式同类别 4，无升级项。

### 类别 6：自行车租赁（序号 31-33）

**HTML 位置：**
- 墙面菜单：`.col-classic` > `.rental-sub` > `.rental-overlay`
- A4 菜单：`.rental-sub` > `.rental-info-wrap` > `.rental-overlay`

| CSV 序号 | HTML 元素 | 格式 |
|---------|-----------|------|
| 31 (1H) | `.rental-price-big` + `.rental-tiers` 第 1 个 `.rental-tier strong` | `¥N / 1H` / `¥N` |
| 32 (4H) | `.rental-tiers` 第 2 个 `.rental-tier strong` | `¥N` |
| 33 (24H) | `.rental-tiers` 第 3 个 `.rental-tier strong` | `¥N` |

---

## 条件类规则

| 类名 | 适用类别 | 判定条件 |
|------|----------|----------|
| `.premium` | 季节限定 | 价格 > 45 |
| `.accent` | 动径特调 | 按序号手动指定（当前：序号 8、9），不自动判定 |
| `.highlight` | 能量组合 | 价格为纯数字（非 `+N`/`-N` 格式） |
| `.upgrade` | 经典日常 | D 列品名 = `升级项` |

**更新时必须检查：**
- 价格变更后是否需要添加/移除条件类（`.premium`、`.highlight`、`.upgrade` 按规则自动判定）
- `.accent` 类保持现有分配不变，如需调整须人工确认

---

## 价格显示规则

| 场景 | CSV 值示例 | HTML 显示 |
|------|-----------|-----------|
| 普通价格 | `25` | `25`（纯数字，无货币符号） |
| 升级项 | `3` | `+3`（加号前缀） |
| 加型组合 | `+15` | `+15`（原值直出） |
| 减型组合 | `-5` | `-5`（原值直出） |
| 租赁主价格 | `25元/小时` | `¥25 / 1H`（带 ¥ 前缀 + 时间单位） |

---

## 不可修改区域

以下内容不来自 CSV 数据行，`/更新菜单` 命令**不得修改**：

| 区域 | 说明 |
|------|------|
| Header | Logo SVG、中英文标语 |
| Footer | 5 项优惠信息 + 货币说明 |
| Section 标题 | 各区域的中英文分类标题（如 `SEASONAL SPECIALS`） |
| 动径特调第 8 格 | Logo 圆形水印 SVG |
| 季节限定图片 | `<img>` 标签的 `src` 属性（品名变更时仅警告） |
| CSS 类结构 | HTML 元素的基础 class（仅操作条件类） |
| 租赁流程文字 | `扫码进行实名核验 > ...` 静态描述 |
